<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SPERO 3D Viewer</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg-color: #f9f9f9;
      --text-color: #333;
      --link-color: #9bbcc7;
      --section-bg: #fff;
      --footer-bg: #eee;
      --nav-bg: #ffffff;
      --highlight-color: #e8f4ff;
    }

    body.dark {
      --bg-color: #121212;
      --text-color: #e0e0e0;
      --link-color: #66baff;
      --section-bg: #1e1e1e;
      --footer-bg: #1a1a1a;
      --nav-bg: #1f1f1f;
      --highlight-color: #1a2a3a;
    }

    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background 0.3s, color 0.3s;
      line-height: 1.6;
    }

    header {
      background-color: var(--nav-bg);
      color: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      padding: 1rem 2rem;
    }

    header nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1000px;
      margin: 0 auto;
      flex-wrap: wrap;
    }

    header nav h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    header nav ul {
      list-style: none;
      display: flex;
      gap: 1rem;
      margin: 0;
      padding: 0;
      flex-wrap: wrap;
    }

    header nav a {
      color: white;
      text-decoration: none;
      font-weight: 500;
    }

    header nav a:hover {
      text-decoration: underline;
    }

    #theme-toggle {
      margin-left: 1rem;
      background: transparent;
      border: 1px solid white;
      color: white;
      padding: 0.4rem 0.8rem;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }

    main {
      max-width: 1000px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    h2 {
      text-align: center;
      margin-bottom: 1.5rem;
      font-size: 1.75rem;
    }

    p {
      font-size: 1.05rem;
      margin-bottom: 1.5rem;
    }

    .viewer-container {
      position: relative;
      width: 100%;
      padding-top: 80%;
      margin-bottom: 2rem;
    }

    .viewer-container iframe {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    section {
      background: var(--section-bg);
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.05);
      margin-bottom: 2.5rem;
      transition: background 0.3s;
    }

    a {
      color: var(--link-color);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }

    footer {
      background: var(--footer-bg);
      text-align: center;
      padding: 1rem;
      font-size: 0.9rem;
      color: var(--text-color);
    }

    :target::before {
      content: "";
      display: block;
      height: 80px;
      margin-top: -80px;
      visibility: hidden;
    }

    /* Tooltip style for model labels */
    .tooltip {
      position: relative;
      display: inline-block;
      cursor: help;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: max-content;
      max-width: 200px;
      background-color: var(--highlight-color);
      color: var(--text-color);
      text-align: center;
      padding: 0.5rem;
      border-radius: 6px;
      position: absolute;
      z-index: 1;
      bottom: 125%; /* Position above */
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 0.9rem;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    @media (max-width: 600px) {
      header nav {
        flex-direction: column;
        align-items: flex-start;
      }

      header nav ul {
        flex-direction: column;
        gap: 0.5rem;
        margin-top: 0.5rem;
      }

      #theme-toggle {
        margin-left: 0;
        margin-top: 0.5rem;
      }
    }
  </style>
</head>


<body>
  <!-- Navigation Bar -->
  <header>
    <nav>
      <h1>SPERO</h1>
      <ul>
        <li><a href="#viewer">Viewer</a></li>
        <li><a href="#downloads">Downloads</a></li>
        <li><a href="https://github.com/kristanhilby/SPERO" target="_blank">GitHub</a></li>
      </ul>
      <button id="theme-toggle">üåô Dark Mode</button>
    </nav>
  </header>

  <!-- Main Content -->
  <main>
    <section id="intro">
      <h2>Welcome to SPERO Supplemental Documentation</h2>
      <p>SPERO is a stopped-pentarotor uncrewed aerial vehicle capable of bidirectional transition. Explore the 3D model, download the design files, and learn how to upload our custom flight controller software to the Pixhawk board.</p>
    </section>

    <!-- SPERO Model Viewer -->
    <section id="viewer">
      <h2>SPERO Model Viewer</h2>
      <div class="viewer-container">
        <iframe
          title="SPERO Model Viewer"
          allow="autoplay; fullscreen; xr-spatial-tracking"
          allowfullscreen
          mozallowfullscreen="true"
          webkitallowfullscreen="true"
          xr-spatial-tracking
          execution-while-out-of-viewport
          execution-while-not-rendered
          web-share
          src="https://sketchfab.com/models/51d265aaed1b4036a16cd939a899f404/embed?autostart=1&camera=0&annotations_visible=1&ui_hint=0&ui_theme=dark">
        </iframe>
      </div>
    </section>

  <!-- Project Files Section -->
  <section id="downloads">
      <h2>Project Files</h2>
      <ul>
        <li><a href="https://anonymous.4open.science/r/SPERO-4A02/README.md" target="_blank">üì¶ 3D Printer Files</a> ‚Äî STL and STEP files for printed parts. </li>
        <li><a href="https://anonymous.4open.science/r/SPERO-4A02/README.md" target="_blank">üõ† CNC Machined Part Files</a> ‚Äî STEP files of the machined components. </li>
        <li><a href="https://anonymous.4open.science/r/SPERO-4A02/README.md" target="_blank">üíß Waterjet Part Files</a> ‚Äî DXF files for waterjet components. </li>
        <li><a href="https://anonymous.4open.science/r/SPERO-4A02/Simulink%20Controller/buildover_fullstatemachine.slx" target="_blank">üöÄ Simulink Flight Controller File</a> ‚Äî Simulink model of the custom flight controller. </li>
        <li><a href="https://anonymous.4open.science/r/SPERO-4A02/README.md" target="_blank">üß† Custom PX4 Code</a> ‚Äî Modified PX4 source code for flight controller. </li>
      </ul>
    </section>

    <section id="custom-controller">
    <h2>Using the Custom PX4 Controller</h2>

    <p>
      This project includes a custom PX4 flight controller built in Simulink using the UAV Toolbox Support Package for PX4. You can integrate and build it directly into the PX4 firmware using Simulink (preferred), or compile it from source using the pre-generated code.
    </p>

    <h3>üöÄ Option 1: Build from Simulink Model (Recommended)</h3>
    <p>
      If you have access to MATLAB/Simulink, this method allows you to generate and deploy a fully custom PX4 firmware with editable control logic.
    </p>

    <h4>üîó Files You Need</h4>
    <ul>
      <li>
        <a href="https://anonymous.4open.science/r/SPERO-4A02/Simulink%20Controller/buildover_fullstatemachine.slx" target="_blank">
          üìÅ Simulink PX4 Model (GitHub)
        </a>
        ‚Äî Includes the Simulink `.slx` file and configuration for PX4 deployment.
      </li>
    </ul>

    <h4>üß∞ Requirements</h4>
    <ul>
      <li>MATLAB R2021b or newer</li>
      <li>Simulink + UAV Toolbox Support Package for PX4</li>
      <li>Ubuntu 20.04 or newer (for building/deploying firmware)</li>
      <li>QGroundControl</li>
    </ul>

    <h4>‚öôÔ∏è Setup Steps</h4>
    <ol>
      <li>
        <strong>Install the PX4 Support Package:</strong><br />
        Follow the official MathWorks instructions to install required packages and configure your environment:
        <br />
        <a href="https://www.mathworks.com/help/uav/setup-and-configuration-px4.html?s_tid=CRUX_lftnav" target="_blank">
          https://www.mathworks.com/help/uav/setup-and-configuration-px4.html
        </a>
      </li>

      <li>
        <strong>Open Simulink Model:</strong><br />
        Launch MATLAB and open the `.slx` file from the <a href="https://anonymous.4open.science/r/SPERO-4A02/Simulink%20Controller/buildover_fullstatemachine.slx" target="_blank"> GitHub folder</a>.
      </li>

      <li>
        <strong>Configure PX4 Target:</strong><br />
        Use the UAV Toolbox to select your hardware (e.g., Pixhawk 6X) and configure build options.
      </li>

      <li>
        <strong>Build and Deploy:</strong><br />
        Click <code>Build</code> in Simulink. This will generate a PX4 firmware binary and walk you through the steps to flash it on the flight controller.
      </li>
    </ol>

    <p>üìò For official reference, see the <a href="https://www.mathworks.com/help/uav/ug/getting-started-with-px4-hardware.html" target="_blank">MathWorks UAV Toolbox PX4 Guide</a>.</p>

    <hr />

    <h3>üõ† Option 2: Build from Source with Pre-Generated Controller Files</h3>
    <p>
      If you do not have access to MATLAB/Simulink, you can still build the firmware manually using the generated C++ code.
    </p>
    <p><strong>‚ö†Ô∏è Note:</strong> This method has <em>not been fully tested</em> with the current PX4 version. It is provided as-is for users familiar with PX4's build system and troubleshooting compiler issues.</p>


    <h4>üì¶ What You Need</h4>
    <ul>
      <li>Ubuntu 20.04 or newer</li>
      <li>PX4-Autopilot source code <strong>v1.12</strong></li>
      <li>GNU ARM toolchain and PX4 build dependencies</li>
      <li>QGroundControl (to flash firmware)</li>
      <li>
        <a href="https://anonymous.4open.science/r/SPERO-4A02/README.md" target="_blank">
          üìÇ Custom PX4 Controller Files
        </a>
      </li>
    </ul>

    <h4>üß™ Setup Instructions</h4>
    <ol>
      <li>
        <strong>Install PX4 build tools:</strong><br />
        <pre><code>bash &lt;(curl -s https://raw.githubusercontent.com/PX4/PX4-Autopilot/main/Tools/setup/ubuntu.sh)</code></pre>
      </li>

      <li>
        <strong>Clone PX4 firmware (v1.12):</strong><br />
        <pre><code>git clone https://github.com/PX4/PX4-Autopilot.git --recursive
  cd PX4-Autopilot
  git checkout v1.12.3</code></pre>
      </li>

      <li>
        <strong>Add the Simulink-generated module:</strong><br />
        Download and copy the <code>px4_simulink_app</code> folder into:
        <pre><code>PX4-Autopilot/src/modules/</code></pre>
      </li>

      <li>
        <strong>Build the PX4 firmware:</strong><br />
        <pre><code>make px4_fmu-v5_default</code></pre>
        <p>(Replace the target depending on your flight controller.)</p>
      </li>

      <li>
        <strong>Flash the firmware:</strong><br />
        Use QGroundControl ‚Üí Custom Firmware ‚Üí Select:
        <pre><code>build/px4_fmu-v5_default/firmware.px4</code></pre>
      </li>

      <li>
        <strong>Start the controller module:</strong><br />
        Open MAVLink shell and run:
        <pre><code>px4_simulink_app start</code></pre>
      </li>
    </ol>

    <h4>‚ÑπÔ∏è Tips</h4>
    <ul>
      <li>To stop the controller: <code>px4_simulink_app stop</code></li>
      <li>If build fails: try <code>make clean</code> before rebuilding</li>
      <li>Core logic lives in <code>ert_main.cpp</code> and generated model files</li>
    </ul>
  </section>

  <!-- Footer -->
  <footer>
    ¬© 2025 Kristan Hilby -- SPERO
  </footer>

  <!-- Dark Mode Script -->
  <script>
    const toggle = document.getElementById('theme-toggle');
    const body = document.body;

    // Load preference
    if (localStorage.getItem('theme') === 'dark') {
      body.classList.add('dark');
      toggle.textContent = '‚òÄÔ∏è Light Mode';
    }

    toggle.addEventListener('click', () => {
      body.classList.toggle('dark');
      const isDark = body.classList.contains('dark');
      toggle.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
    });
  </script>
</body>
</html>
